"""
AVE MODULE 110: INDUSTRIAL AEROSPACE SCALE-UP
---------------------------------------------
Simulates macroscopic heavy-lift and metric engineering systems.
1. Phased Array Scaling: Proves a 1m^2 YBCO PCB safely lifts 2.5 metric tons.
2. Metric Refraction Capacitor: Proves the c^2 multiplier turns a 10^-17 
   metric shift into 130 G's of macroscopic ponderomotive acceleration.
3. Sapphire Phonon Centrifuge: Calculates artificial gravity (6.35 Gs) 
   generated by an EM-driven acoustic vortex, stabilized by a Toroidal B-Field.
"""
import numpy as np
import matplotlib.pyplot as plt
import os

OUTPUT_DIR = "manuscript/chapters/12_experimental_falsification/simulations/outputs"
os.makedirs(OUTPUT_DIR, exist_ok=True)

def simulate_heavy_lift_aerospace():
    print("Generating Industrial Aerospace Blueprint Telemetry...")
    
    fig, axs = plt.subplots(1, 3, figsize=(18, 6), dpi=150)
    fig.patch.set_facecolor('#050508')
    for ax in axs:
        ax.set_facecolor('#050508')
        ax.tick_params(colors='lightgray')
        for spine in ax.spines.values(): spine.set_color('#333333')
        ax.grid(True, ls=':', color='#333333')
        
    xi_topo = 4.149e-7 # C/m
    c = 299792458
    
    # ---------------------------------------------------------
    # 1. YBCO Phased Array Hull Plating (Parallel Lift)
    # ---------------------------------------------------------
    ax1 = axs[0]
    pcb_area_m2 = np.linspace(0.1, 10.0, 500)
    pitch_mm = 1.0 # 1 mm spaced micro-inductors
    nodes_per_m2 = (1000 / pitch_mm)**2 # 1,000,000 nodes per m^2
    
    total_nodes = pcb_area_m2 * nodes_per_m2
    lift_per_node_kg = 0.00249 # Safe lift at 59kV
    total_lift_tons = (total_nodes * lift_per_node_kg) / 1000
    
    ax1.plot(pcb_area_m2, total_lift_tons, color='#00ffcc', lw=4, label='Static Lift Capacity (Metric Tons)')
    ax1.axhline(2.49, color='#ff3366', lw=2, linestyle='--', label='1 m$^2$ Panel (2.5 Tons)')
    ax1.axvline(1.0, color='gray', lw=1.5, linestyle=':')
    
    ax1.set_title('1. YBCO Phased Array Hull Plating', color='white', weight='bold', fontsize=13)
    ax1.set_xlabel('Active PCBA Hull Area (m$^2$)', color='white')
    ax1.set_ylabel('Total Lifting Capacity (Metric Tons)', color='white')
    ax1.legend(loc='upper left', facecolor='#111111', edgecolor='gray', labelcolor='white')
    ax1.text(3, 10, "By printing 1,000,000 micro-inductors per $m^2$,\nwe bypass the 2.5g single-node limit.\nForce adds extensively in parallel.", color='white', ha='left', fontsize=9, bbox=dict(facecolor='#111111', edgecolor='gray'))
    
    # ---------------------------------------------------------
    # 2. Metric Refraction Capacitor (The c^2 Multiplier)
    # ---------------------------------------------------------
    ax2 = axs[1]
    V_applied_kV = np.linspace(0, 59, 500) # Safe below 60kV yield
    E_field = (V_applied_kV * 1000) / 0.001 # 1mm gap
    
    epsilon_0 = 8.854e-12
    # BaTiO3 High-K Dielectric (e_r = 10000)
    u_BaTiO3 = 0.5 * (10000 * epsilon_0) * E_field**2
    u_sat = 7.75e24
    
    delta_n = u_BaTiO3 / u_sat
    grad_n = delta_n / 0.001 # gradient across 1mm
    a_ponderomotive_Gs = (c**2 * grad_n) / 9.81
    
    ax2.plot(V_applied_kV, a_ponderomotive_Gs, color='#FFD54F', lw=4, label='Ponderomotive Acceleration (G-Force)')
    ax2.axhline(130.0, color='#ff3366', lw=1.5, linestyle=':', label='50 kV Operating Target (130 Gs)')
    
    ax2.set_title('2. Metric Refraction Capacitor ($BaTiO_3$)', color='white', weight='bold', fontsize=13)
    ax2.set_xlabel('Topological Voltage (kV) [Sub-Yield]', color='white')
    ax2.set_ylabel('Macroscopic Acceleration (G-Force)', color='white')
    ax2.legend(loc='upper left', facecolor='#111111', edgecolor='gray', labelcolor='white', fontsize=9)
    ax2.text(25, 20, "A 1mm graded BaTiO3 gap at 50 kV shifts the metric by\na minuscule $10^{-17}$. But multiplied by $c^2$,\nthis spatial gradient generates a massive\n130 G's of macroscopic physical acceleration.", color='white', ha='center', fontsize=9, bbox=dict(facecolor='#111111', edgecolor='gray'))

    # ---------------------------------------------------------
    # 3. The Sapphire Phonon Centrifuge
    # ---------------------------------------------------------
    ax3 = axs[2]
    # Simulate both mechanical Tungsten and Acoustic Sapphire
    v_target = np.linspace(0, 12000, 500)
    R_sphere = 0.5 # 1-meter diameter
    
    rho_tungsten = 15600.0
    rho_sapphire = 3980.0
    rho_vac = 7.91e6
    
    # Entrainment stops when the rotor shatters
    v_vac_W = np.where(v_target <= 500, v_target * (rho_tungsten / rho_vac), np.nan)
    v_vac_Al2O3 = np.where(v_target <= 11100, v_target * (rho_sapphire / rho_vac), np.nan)
    
    a_vac_W_Gs = (v_vac_W**2 / R_sphere) / 9.81
    a_vac_Al2O3_Gs = (v_vac_Al2O3**2 / R_sphere) / 9.81
    
    ax3.plot(v_target, a_vac_Al2O3_Gs, color='#00ffcc', lw=4, label='Acoustic Sapphire Vortex (6.35 Gs)')
    ax3.plot(v_target, a_vac_W_Gs, color='#ff3366', lw=4, label='Mechanical Tungsten Rotor (Shatters)')
    
    ax3.axvline(500, color='#ff3366', lw=1.5, linestyle=':', label='Mechanical Shatter Limit')
    ax3.axvline(11100, color='#00ffcc', lw=1.5, linestyle=':', label='Acoustic Wave Limit')
    
    ax3.set_title('3. Acoustic Phonon Centrifuge', color='white', weight='bold', fontsize=13)
    ax3.set_xlabel('Kinematic Entrainment Velocity (m/s)', color='white')
    ax3.set_ylabel('Generated Artificial Gravity (G)', color='white')
    ax3.set_ylim(0, 7)
    ax3.legend(loc='upper left', facecolor='#111111', edgecolor='gray', labelcolor='white', fontsize=8)
    ax3.text(4000, 2, "Spinning the physical mass shatters the rotor.\nSpinning an EM-driven acoustic wave through\na stationary crystal bypasses material limits,\ngenerating 6.3 Gs of artificial gravity.", color='white', ha='left', fontsize=8, bbox=dict(facecolor='#111111', edgecolor='gray'))

    plt.tight_layout()
    filepath = os.path.join(OUTPUT_DIR, "industrial_aerospace_blueprints.png")
    plt.savefig(filepath, facecolor=fig.get_facecolor(), bbox_inches='tight')
    plt.close()
    print(f"Saved: {filepath}")

if __name__ == "__main__": simulate_heavy_lift_aerospace()